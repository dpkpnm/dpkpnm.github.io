<template>
  <div id="app">
    <div ref="editor" class="editor" contenteditable v-shortkey="{next:['ctrl', '/'],save:['ctrl','s'],tab:['tab']}" @shortkey="changeListType">
      <li v-for="(line,index) in lines" :key="index" :class="line.type">{{line.title}}</li>
    </div>
  </div>
</template>
<script>
export default {
  name: 'App',
  data: function() {
    return {
      keys: ["note", "event", "task", "taskcomplete", "taskirrelevant", "taskmigrated", "taskscheduled"],
      lines: [
        { title: "F.13", type: "date" },
        { type: "task", title: "task incomplete" },
        { type: "taskcomplete", title: "task complete" },
        { type: "taskirrelevant", title: "task irrelevant" },
        { type: "taskmigrated", title: "task migrated" },
        { type: "taskscheduled", title: "task scheduled in future log" },
        { type: "note", title: "notes" },
        { type: "event", title: "events" },
        { title: "F.12", type: "date" },
        { type: "task", title: "task incomplete" },
        { type: "taskcomplete", title: "task complete" },
        { type: "taskirrelevant", title: "task irrelevant" },
        { type: "taskmigrated", title: "task migrated" },
        { type: "taskscheduled", title: "task scheduled in future log" },
        { type: "note", title: "notes" },
        { type: "event", title: "events" },
      ],
      days: ['S', 'M', 'T', 'W', 'T', 'F', 'S']
    }
  },
  methods: {
    changeListType(event) {
      event.preventDefault();
      var el = document.getSelection().focusNode.nodeType == 1 ? document.getSelection().focusNode : document.getSelection().focusNode.parentElement;
      var cls = el.classList[0];
      if (event.srcKey == 'next') {
        el.classList.remove(cls);
        var index = this.keys.indexOf(cls);
        index = this.keys.length == index ? 0 : index + 1;
        el.classList.add(this.keys[index]);
      } else if (event.srcKey == 'save') {
        this.save();
      } else if (event.srcKey == 'tab') {
        el.classList.add("m16")
        debugger;
      }
    },
    save() {
      console.log(this.$refs.editor.children);
      var lines = [...this.$refs.editor.children].reduce((a, v) => {
        a.push({ title: v.innerHTML, type: v.className });
        return a;
      }, [])
      this.lines = lines;
      localStorage.setItem('journal', JSON.stringify(lines));
    },
    getDate() {
      var dt = new Date();
      return this.days[dt.getDay()] + "." + dt.getDate();
    }
  },
  mounted() {
    if (localStorage.getItem("journal"))
      this.lines = JSON.parse(localStorage.getItem('journal'));

  }
}
</script>
<style>
body {
  font-family: monospace, CustomSerif, Georgia, Cambria, Times New Roman, serif !important;
  color: #222;
  height: 100%;
  font-size: 16px;
  font-weight: 400;
}
.date {
  font-weight: bold;
  color: #CCC;
  margin-top: 24px
}

.editor {
  margin: 64px auto;
  width: 800px;
  outline: none;
  line-height: 1.6rem;
  white-space: pre-wrap;
  display: block;

}
li {
  list-style-type: none;
  display: flex;
}
li.taskirrelevant {
  color: #ccc
}
li:before {
  margin-right: 16px;
  display: inline-block;
  padding-left: 8px;
}
li.event:before {
  content: '\0260E';
  font-size: 12px;
  margin-right: 14px;
}
li.taskirrelevant:before, li.task:before {
  content: '\02192';
  font-size: 20px;
}
li.note:before {
  content: '\02022';
}
li.taskcomplete:before {
  content: '\02713';
  color: green;
}
li.undefined:before {
  content: ' ';
}

li.taskscheduled:before {
  content: '\02191';
  font-size: 20px;
  color: red;
}
li.taskmigrated:before {
  content: '\02193';
  font-size: 20px;
}
li.m16 {
  margin-left: 16px;
}
</style>
